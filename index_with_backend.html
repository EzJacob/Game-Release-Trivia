<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Release Trivia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #2c2c2c;
      color: white;
      overflow: hidden;
    }

    .hidden { display: none; }

    .game-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 70vh;
      position: relative;
    }

    .game-item {
      width: 40%;
      cursor: pointer;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .game-item:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }

    img {
      width: 100%;
      max-height: 60vh;
      object-fit: contain;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    h1 { margin-bottom: 10px; }

    #score {
      font-size: 2em;
      margin-bottom: 20px;
      font-weight: bold;
    }

    #best-score-display {
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    #result {
      font-size: 2em;
      font-weight: bold;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    .correct { color: green; }
    .incorrect { color: red; }
  </style>
</head>

<body>
  <div id="start-screen">
    <h1>Game Release Trivia</h1>
    <p id="best-score-display">Best score: 0</p>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div id="game-screen" class="hidden">
    <h1>Game Release Trivia</h1>
    <p>Which game was released earlier?</p>
    <p>Score: <span id="score">0</span></p>

    <div class="game-container">
      <div class="game-item" id="game1" onclick="guess(true)">
        <p id="game1-title"></p>
        <p id="game1-date" class="hidden"></p>
        <img id="game1-img" src="" alt="Game 1 Cover">
      </div>

      <div class="game-item" id="game2" onclick="guess(false)">
        <p id="game2-title"></p>
        <p id="game2-date" class="hidden"></p>
        <img id="game2-img" src="" alt="Game 2 Cover">
      </div>
    </div>

    <p id="result"></p>
  </div>

  <div id="end-screen" class="hidden">
    <h1>Game Over</h1>
    <p>Your score: <span id="final-score"></span></p>
    <p>Best score: <span id="best-score"></span></p>
    <button onclick="startGame()">Play Again</button>
  </div>

  <script>
    let games = [];
    let game1, game2;
    let score = 0;
    let bestScore = localStorage.getItem('bestScore') || 0;

    document.getElementById('best-score-display').innerText = `Best score: ${bestScore}`;

    async function fetchGames() {
      try {
        const response = await fetch('http://localhost:5000/games');
        games = await response.json();
      } catch (error) {
        console.error('Error fetching games:', error);
      }
    }

    async function fetchReleaseDate(title) {
      try {
        const response = await fetch(`http://localhost:5000/game-date?title=${encodeURIComponent(title)}`);
        const data = await response.json();
        return data.release_date || null;
      } catch (error) {
        console.error(`Error fetching date for ${title}:`, error);
        return null;
      }
    }

    async function startGame() {
      score = 0;
      document.getElementById('score').innerText = score;
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      document.getElementById('end-screen').classList.add('hidden');

      await fetchGames();
      getRandomGames();
    }

    function getRandomGames() {
      fetchGames();
      if (games.length < 2) return;
      
      let index1 = Math.floor(Math.random() * games.length);
      let index2;
      do {
        index2 = Math.floor(Math.random() * games.length);
      } while (index1 === index2);

      game1 = games[index1];
      game2 = games[index2];

      document.getElementById('game1-img').src = game1.image_url;
      console.log(document.getElementById('game1-img'));
      document.getElementById('game1-title').innerText = game1.name;
      document.getElementById('game1-date').classList.add('hidden');

      document.getElementById('game2-img').src = game2.image_url;
      document.getElementById('game2-title').innerText = game2.name;
      document.getElementById('game2-date').classList.add('hidden');

      document.getElementById('result').innerText = '';
    }

    async function guess(isLeft) {
      const game1Date = await fetchReleaseDate(game1.name);
      const game2Date = await fetchReleaseDate(game2.name);

      document.getElementById('game1-date').innerText = `Released: ${game1Date}`;
      document.getElementById('game1-date').classList.remove('hidden');
      document.getElementById('game2-date').innerText = `Released: ${game2Date}`;
      document.getElementById('game2-date').classList.remove('hidden');

      const correct = (isLeft && game1Date <= game2Date) || (!isLeft && game2Date <= game1Date);
      const resultMessage = correct ? "Correct!" : "Incorrect!";
      const resultClass = correct ? "correct" : "incorrect";

      if (correct) {
        score++;
        document.getElementById('score').innerText = score;
      }

      document.getElementById('result').innerText = resultMessage;
      document.getElementById('result').classList.add(resultClass);

      setTimeout(() => {
        document.getElementById('game1-date').classList.add('hidden');
        document.getElementById('game2-date').classList.add('hidden');
        document.getElementById('result').classList.remove(resultClass);

        if (!correct) {
          endGame();
        } else {
          getRandomGames();
        }
      }, 3000);
    }

    function endGame() {
      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem('bestScore', bestScore);
      }

      document.getElementById('final-score').innerText = score;
      document.getElementById('best-score').innerText = bestScore;

      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('end-screen').classList.remove('hidden');
    }
  </script>
</body>
</html>
